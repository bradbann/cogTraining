<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
	<title>认知训练平台</title>

	<!-- Bootstrap -->
	<link href="${basePath!}/assets/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="${basePath!}/assets/css/home.css">
	
</head>
<body style="background-color: #eee">
	
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand cog-brand" href="">CogTraining</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="${basePath!}/home">主页 </a></li>
					<li class="active"><a href="${basePath!}/brain_profile">个人数据<span class="sr-only">(current)</span></a></li>
					<li><a href="${basePath!}/games">游戏</a></li>
				</ul>
				
				<#include "/common/account_nav.html">
			</div><!-- /.navbar-collapse -->
		</div><!-- /.container-fluid -->
	</nav>



	<div class="main-content">
		<div id="part-1">
			<div class="container" style="width: 100%">

				<div class="col-xs-12 cols">
					<div class="part-left hidden-sm hidden-xs col-md-2" id="part-1-1">
						<div class="list-group">
							<a href="${basePath!}/brain_profile" class="list-group-item">
								概述
							</a>
							<a href="${basePath!}/training_history/summaries" 
								class="list-group-item active">训练历史</a>
							<a href="${basePath!}/comparison" class="list-group-item">比较情况</a>
						</div>
					</div>
					<div class="dropdown visible-sm visible-xs pull-left">
						<a class="btn btn-cog dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
							训练历史
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
							<li><a href="${basePath!}/brain_profile">概述</a></li>
							<li><a href="${basePath!}/training_history/summaries">训练历史</a></li>
							<li><a href="${basePath!}/comparison">比较情况</a></li>
						</ul>
					</div>

					<div class="part-right col-xs-12 col-md-10">

						<div class="row">
							<div class="col-xs-12">
								<div class="panel panel-default">

									<div class="panel-body">
										<div class="row">
											<div class="col-xs-12">
												<h2 class="text-left">训练历史</h2>
											</div>
											
										</div>
										<div class="row training-history-top-btn">
											<div class="col-xs-12">
												<div class="col-xs-6 btn-group">
													<a href="" class="btn btn-default training-history-top-btn-1 disabled">总览</a>
													<a href="${basePath!}/training_history/detail" class="btn btn-default training-history-top-btn-2 bluea">趋势</a>
												</div>
												<div class="col-xs-6 btn-group hidden-xs">
													<a href="${basePath!}/training_history/summaries" class="btn btn-default training-history-top-btn-3 bluea">最近四周</a>
													<a href="" 
													class="btn btn-default training-history-top-btn-4 disabled">所有时间</a>	
												</div>

											</div>
										</div>
										<div class="row training-history-row">
											<div class="col-xs-12 col-sm-4 training-history-row-left">
												<div class="row">
													<h3><small>自从 ${createDate!0}</small></h3>
													<h4>至少玩了一个游戏的天数</h4>
													<h1>${trainDays!0}</h1>
												</div>
											</div>
											<div class="col-xs-12 col-sm-4 training-history-row-middle">
												<div class="row">
													<div class="col-xs-12">

														<h3><small>一周平均天数</small></h3>

														<h1 id="avg-days-per-week">${daysPerWeek!0}天</h1>
														<div class="row days-round-row">
															<div class="days-round active"></div>
															<div class="days-round"></div>
															<div class="days-round"></div>
															<div class="days-round"></div>
															<div class="days-round"></div>
															<div class="days-round"></div>
															<div class="days-round"></div>
														</div>
														<h3><small>训练天数最长的一周 - ${maxTrainDay!}天</small></h3>

													</div>
												</div>
											</div>
											<div class="col-xs-12 col-sm-4 training-history-row-left hidden-xs">
												<div class="row">
													<div class="col-xs-12">

														<h3><small>持续时间最长</small></h3>
														<h1 id="max-continues-days">0天</h1>
														<div class="row days-round-row"><div style="min-height: 20px"></div></div>
														<h3><small>最长连续训练 - 0天</small></h3>
													</div>
												</div>
											</div>

										</div>

										<div class="row  training-history-row">
											<div class="col-xs-12 col-sm-4 training-history-row-left">
												<div class="row">
													<h3><small></small></h3>
													<h4>总共训练次数</h4>
													<h1>${totalPlayTimes!0}</h1>
												</div>
											</div>
											<div class="col-xs-12 col-sm-8 training-history-row-middle">
												<div class="row">
													<div class="col-xs-12">
														<div class="col-sm-6 col-xs-12">
															<h3><small>各认知领域的训练次数</small></h3>
															<div class="row">

																<canvas id="piecharts"></canvas>

															</div>
														</div>
														<div class="col-sm-6 col-xs-12" id="piecharts-bar-sample">
															<h3><small></small></h3>
															<div class="row">
																<div class="row">
																	<h5><s id="piecharts-bar-sample-1"></s>速度训练<v id="piecharts-bar-sample-txt-1"></v></h5>
																</div>
																<div class="row">
																	<h5><s id="piecharts-bar-sample-2"></s>记忆训练<v id="piecharts-bar-sample-txt-2"></v></h5>
																</div>
																<div class="row">
																	<h5><s id="piecharts-bar-sample-3"></s>注意训练<v id="piecharts-bar-sample-txt-3"></v></h5>
																</div>
																<div class="row">
																	<h5><s id="piecharts-bar-sample-4"></s>灵活训练<v id="piecharts-bar-sample-txt-4"></v></h5>
																</div>
																<div class="row">
																	<h5><s id="piecharts-bar-sample-5"></s>逻辑训练<v id="piecharts-bar-sample-txt-5"></v></h5>
																</div>


															</div>
														</div>
													</div>
												</div>
											</div>


										</div>


										<div class="row  training-history-row">
											<div class="col-xs-12 col-sm-4 training-history-row-left">
												<div class="row">
													<h3><small></small></h3>
													<h4>CPI的变化</h4>
													<#if change &lt; 0>
													<h1><span class="glyphicon glyphicon-triangle-top decrease" aria-hidden="true"></span>${change?replace("-","")}</h1>
													<#elseif change == 0>
													<h1>-</h1>
													<#else>
													<h1><span class="glyphicon glyphicon-triangle-top increase" aria-hidden="true"></span>${change!0}</h1>
													</#if>
													
													<!-- glyphicon-triangle-bottom decrease 如果是减少了 替换这个class -->
												</div>
											</div>
											<div class="col-xs-12 col-sm-8 training-history-row-middle">
												<div class="row">
													<div class="col-xs-12">
														<div class="col-xs-6">
															<h3><small>现在的CPI</small><br>${lastLPI}</h3>

															<div class="row">
																<canvas id="chart1" height="200" class="col-xs-12" />

															</div>
															<h4><small>你的起始CPI - ${startLPI!}</small></h4>
														</div>
														<div class="col-xs-6" style="text-align: left;">
															<h3><small>你最好的CPI</small></h3>
															<#if bestLPI != 0 >
															<h1 id="best-cpi">${bestLPI}</h1>
															<h4><small>${bestDate}</small></h4>
															<#else>
															<h1 id="best-cpi">-</h1>
															<h4><small>-</small></h4>
															</#if>
														</div>
													</div>
												</div>
											</div>


										</div>								
										<div class="row ">
											<div class="col-xs-12">
												<a href="${basePath!}/training_history/detail">
												<h4 class="bluea" style="text-align: right;margin:10px;">查看趋势 →</h4></a>
											</div>

										</div>								

									</div>
									
									
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<#include "/common/bottom.html">



<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="${basePath!}/assets/js/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="${basePath!}/assets/js/bootstrap.min.js"></script>
<script type="text/javascript" src="${basePath!}/assets/js/Chart.js"></script>

<script type="text/javascript">

	window.onload=function(){
		var s_height=$(window).height();
		var navbar_height=$("#navbar").outerHeight();
		$("#part-1").css("min-height",s_height-navbar_height-$("#part-6").outerHeight());
		$("#part-1").css("margin-top",navbar_height);


		//每周游戏总数的统计
		var week_data=[123,312,20,1];
		var week_max=0;
		for(var i=0;i<4;i++){
			if (week_data[i]>week_max) {
				week_max=week_data[i];
			}
		}
		
		for(var i=0;i<4;i++){
			console.log(week_data[i]/week_max);
			console.log(100*0.8*week_data[i]/week_max+"%");
			$("#week-bar-"+(i+1)).css("width",100*0.8*week_data[i]/week_max+"%");
			$("#total-txt-"+(i+1)).html(week_data[i]);
		}

		//饼图
		var training_data=${classPie!};
		var pieData = [
		{
			value: training_data[0],
			color:"#F7464A",
			highlight: "#FF5A5E",
			label: "速度训练"
		},
		{
			value: training_data[1],
			color: "#46BFBD",
			highlight: "#5AD3D1",
			label: "记忆训练"
		},
		{
			value: training_data[2],
			color: "#FDB45C",
			highlight: "#FFC870",
			label: "注意训练"
		},
		{
			value: training_data[3],
			color: "#949FB1",
			highlight: "#A8B3C5",
			label: "灵活训练"
		},
		{
			value: training_data[4],
			color: "#4D5360",
			highlight: "#616774",
			label: "逻辑训练"
		}

		];
		var ctx = document.getElementById("piecharts").getContext("2d");
		window.myPie = new Chart(ctx).Pie(pieData);
		for (var i = 0; i <5; i++) {
			$("#piecharts-bar-sample-txt-"+(i+1)).html(training_data[i]);
		}

		//折线图
		// var cpi_data=[30,23,111,32,50];
		var ctx1 = document.getElementById("chart1").getContext("2d");
		window.myLine = new Chart(ctx1).Line(lineChartData, {
			showScale: false,
			pointDot : true,
			responsive: false,
			scaleSteps:10,
			scaleStepWidth:200,
			scaleOverride : true,

		});
		// for (var i = 0; i <5; i++) {
		// 	$("#linecharts-bar-sample-txt-"+(i+1)).html(cpi_data[i]);
		// }
	}
	$("#carousel-example-generic").carousel({
		interval:false
	})

</script>
<script>
	Chart.defaults.global.pointHitDetectionRadius = 1;
	Chart.defaults.global.customTooltips = function(tooltip) {

		var tooltipEl = $('#chartjs-tooltip');

		if (!tooltip) {
			tooltipEl.css({
				opacity: 0
			});
			return;
		}

		tooltipEl.removeClass('above below');
		tooltipEl.addClass(tooltip.yAlign);

		var innerHtml = '';
		// for (var i = tooltip.labels.length - 1; i >= 0; i--) {
		// 	innerHtml += [
		// 	'<div class="chartjs-tooltip-section">',
		// 	'	<span class="chartjs-tooltip-key" style="background-color:' + tooltip.legendColors[i].fill + '"></span>',
		// 	'	<span class="chartjs-tooltip-value">' + tooltip.labels[i] + '</span>',
		// 	'</div>'
		// 	].join('');
		// }
		tooltipEl.html(innerHtml);

		tooltipEl.css({
			opacity: 1,
			left: tooltip.chart.canvas.offsetLeft + tooltip.x + 'px',
			top: tooltip.chart.canvas.offsetTop + tooltip.y + 'px',
			fontFamily: tooltip.fontFamily,
			fontSize: tooltip.fontSize,
			fontStyle: tooltip.fontStyle,
		});
	};
	var randomScalingFactor = function() {
		return Math.round(Math.random() * 100);
	};
	var lineChartData = {
		labels: ${weekLPI!},
		datasets: [{
			label: "CPI",
			fillColor: "rgba(220,220,220,0)",
			strokeColor: "#4dbcb6",
			pointColor: "rgba(220,220,220,0.1)",
			pointStrokeColor: "rgba(220,220,220,0.1)",
			pointHighlightFill: "rgba(220,220,220,0.1)",
			pointHighlightStroke: "rgba(220,220,220,0.1)",
			data: ${weekLPI!}
		}]
	};


</script>
</body>
</html>
